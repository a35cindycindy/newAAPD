<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <title>9</title>
  </head>
  <body>
    <!-- <%- include('./layout/header'); -%> -->
    <div class="wrapper">
      <div class="app-wrapper">
        <!-- 手機外框 -->
        <section class="app-content">
          <div class="status-bar">
            <div class="iphone-time"><time datetime="09:41">9:41</time></div>
            <div class="notch" aria-hidden="true">
              <img
                src="/assets/images/icon-notch-6341937a.svg"
                alt="status"
                height="30"
              />
            </div>
            <div class="iphone-status">
              <img
                src="/assets/images/icon-status-650aa77e.svg"
                alt="status"
                height="13"
              />
            </div>
          </div>
 
          <!-- 實際內容畫面，內容寫在這 -->
          <main class="container">
            <section class="py-4">
              <span
                class="material-icons-outlined text-neutral-700 fs-4 pt-3 pb-3 pe-3"
              >
                <a href="7.html" class="text-decoration-none text-neutral-700">
                  chevron_left
                </a>
              </span>
            </section>
            <section class="py-4 text-center">
              <h1 class="text-neutral-800 fw-bold mb-4 fs-7">
                第一句話不需要完美, 真誠最重要
              </h1>
              <span
                class="d-inline-flex text-secondary-700 rounded-pill px-4 py-3 bg-secondary-200 fw-bold fs-8 mb-4 align-middle"
              >
                <img
                  src="/assets/images/7/magic-hat-green.png"
                  alt="magic-hat"
                  class="me-2"
                  style="height: 20px; width: 20px"
                />
                選擇你的專屬話題
              </span>
              <div class="mb-8">
                <div class="textarea-wrapper">
                  <textarea
                    class="form-control text-neutral-700 fw-medium"
                    placeholder="請輸入文字"
                    id="topic"
                    style="height: 120px"
                    maxlength="100"
                  >嗨嗨我是Jerry</textarea
                  >
                  <div class="char-counter-inside">
                    <span id="charCount">0</span>/100
                  </div>
                </div>
                <!-- <label for="shortgoal" class="text-neutral-700 fs-8 fw-medium word-bg"></label> -->
              </div>
              <div class="mb-35">
                <a href="10.html"
                  ><button
                    class="btn w-100 bg-primary-700 py-12 text-primary-50 rounded-pill"
                  >
                    送出
                  </button></a
                >
              </div>
            </section>
          </main>
          <img
            src="/assets/images/keyboard.png"
            alt="keyboard"
            class="keyboard"
          />
          <!-- 實際內容畫面，內容寫到這 -->
        </section>
      </div>
    </div>

    <script type="module" src="/js/9.js"></script>
    <script type="module" src="../main.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const textarea = document.getElementById("topic");
        const charCount = document.getElementById("charCount");
        const charCounter = document.querySelector(".char-counter-inside");
        const submitBtn = document.querySelector("button");

        if (!textarea || !charCount) return;

        // 初始化
        if (submitBtn) submitBtn.classList.add("submit-btn");
        const MAX = 100;
        let isDone = false;

        function setBtnEnabled(enabled) {
          if (!submitBtn) return;
          submitBtn.disabled = !enabled;
          submitBtn.classList.toggle("disabled", !enabled);
        }

        function setCounterState(state) {
          if (!charCounter) return;
          charCounter.classList.remove("error", "done");
          if (state) charCounter.classList.add(state); // 'error' | 'done'
        }

        function setTextareaState(state) {
          textarea.classList.remove("correct", "error", "done", "disabled");
          if (state) textarea.classList.add(state);
        }

        function refresh() {
          const len = textarea.value.length;
          charCount.textContent = len;

          // 狀態邏輯
          if (len > MAX) {
            setTextareaState("error");
            setCounterState("error"); // >100：紅色計數
            setBtnEnabled(false); // 按鈕禁用（淡粉色）
            isDone = false;
          } else if (len === MAX && isDone) {
            // 只有「按 Enter」後才維持 done 視覺
            setTextareaState("done");
            setCounterState("done"); // 100：藍色計數
            setBtnEnabled(true);
          } else if (len > 0) {
            setTextareaState("correct"); // 1–99
            setCounterState(null);
            setBtnEnabled(true);
            isDone = false; // 重新輸入後，取消 done
          } else {
            setTextareaState(null); // default
            setCounterState(null);
            setBtnEnabled(true);
            isDone = false;
          }
        }

        // 初始
        refresh();

        // 監聽輸入
        textarea.addEventListener("input", refresh);

        // Enter 觸發 done（剛好 100）
        textarea.addEventListener("keydown", (e) => {
          if (e.key === "Enter" && textarea.value.length === MAX) {
            isDone = true; // 標記完成
            refresh(); // 套用 done 視覺
            // 若需要 Enter 時阻止換行，可解開下一行：
            // e.preventDefault();
          }
        });

        // press 視覺只交給 CSS（:focus/:active），不改邏輯
      });
    </script>
  </body>
</html>
